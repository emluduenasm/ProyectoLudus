<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin · Diseños</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="/styles.css"/>
  <style>
    .admin-wrap{max-width:1100px;margin:2rem auto;padding:1rem}
    .toolbar{display:flex;gap:.5rem;align-items:center;margin-bottom:.75rem}
    .toolbar input{flex:1}
    .filters{
      display:grid;
      grid-template-columns: 1fr 140px 150px 1fr 1fr 160px 120px;
      gap:.5rem;
      align-items: end;
      margin: .5rem 0 1rem;
    }
    .filters .form-group label{font-size:.82rem;color:#64748b;margin-bottom:.25rem;display:block}
    table{width:100%;border-collapse:separate;border-spacing:0 .5rem}
    td,th{padding:.6rem .8rem;background:#fff}
    th{color:#334155;text-align:left}
    td:first-child,th:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    td:last-child,th:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    .pill{padding:.2rem .6rem;border-radius:999px;background:#e2e8f0;color:#1e293b;font-size:.8rem}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap}
    .muted-sm{color:#64748b;font-size:.85rem}
    .pagination{display:flex;gap:.5rem;justify-content:flex-end;margin-top:1rem}
    .pagination button{min-width:2.25rem}
    .thumb{width:56px;height:56px;border-radius:8px;object-fit:cover;background:#f1f5f9}
    .btn-danger{background:#dc2626;color:#fff}
    .btn-danger:hover{filter:brightness(.95)}
    .switch{appearance:none;width:42px;height:24px;background:#e2e8f0;border-radius:999px;position:relative;outline:none;cursor:pointer;vertical-align:middle}
    .switch:after{content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:transform .2s ease}
    .switch:checked{background:#2563eb}
    .switch:checked:after{transform:translateX(18px)}
    .right{text-align:right}
    .designer-badge-banned{display:inline-block;margin-top:.25rem;padding:.15rem .55rem;border-radius:999px;background:#fee2e2;color:#991b1b;font-size:.75rem;font-weight:600}
    .status-pill{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .6rem;border-radius:999px;font-size:.75rem;font-weight:600}
    .status-pill.published{background:#dcfce7;color:#166534}
    .status-pill.pending{background:#fef3c7;color:#92400e}
    .status-pill.rejected{background:#fee2e2;color:#991b1b}
    #reviewSection{background:#fff;box-shadow:var(--shadow-sm,0 2px 10px rgba(2,6,23,.06));border-radius:12px}
    .review-list{display:grid;gap:1rem}
    .review-card{display:grid;grid-template-columns:64px 1fr auto;gap:1rem;align-items:start;border:1px solid #e2e8f0;border-radius:12px;padding:.8rem}
    .review-card .thumb{width:64px;height:64px;border-radius:12px;object-fit:cover;background:#f8fafc}
    .review-card h3{margin:0;font-size:1.05rem}
    .review-meta{color:#64748b;font-size:.85rem;margin-top:.25rem}
    .review-actions{display:flex;flex-direction:column;gap:.5rem}
    .btn-success{background:#16a34a;color:#fff}
    .btn-success:hover{filter:brightness(.95)}
    @media(max-width:720px){
      .review-card{grid-template-columns:1fr;grid-template-rows:auto;justify-items:start}
      .review-card .thumb{width:100%;height:200px;object-fit:cover}
      .review-actions{flex-direction:row}
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container nav">
      <a class="brand" href="/"><img src="/img/logo.png" alt="Logo"/></a>
      <nav class="menu">
        <a href="/"><i class="fa-solid fa-house"></i> Inicio</a>
        <a href="/upload.html"><i class="fa-solid fa-cloud-arrow-up"></i> Subir diseño</a>
      </nav>
    </div>
  </header>

  <main class="admin-wrap">
    <h1>Panel admin · Diseños</h1>

    <nav class="admin-subnav">
      <a href="/admin/designs.html" class="tab"><i class="fa-solid fa-palette"></i> Diseños</a>
      <a href="/admin/users.html"   class="tab"><i class="fa-solid fa-users-gear"></i> Usuarios</a>
    </nav>

    <!-- Buscador rápido -->
    <div class="toolbar">
      <input id="q" type="search" class="input" placeholder="Buscar por título o diseñador…"/>
      <button id="btnSearch" class="btn"><i class="fa-solid fa-magnifying-glass"></i> Buscar</button>
      <span id="resultInfo" class="muted-sm"></span>
    </div>

    <!-- FILTROS -->
    <div class="filters">
      <div class="form-group">
        <label for="fCategory">Categoría</label>
        <select id="fCategory" class="input">
          <option value="">Todas</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fPublished">Publicado</label>
        <select id="fPublished" class="input">
          <option value="">Todos</option>
          <option value="1">Sí</option>
          <option value="0">No</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fSort">Ordenar por</label>
        <select id="fSort" class="input">
          <option value="newest">Más nuevos</option>
          <option value="oldest">Más antiguos</option>
          <option value="likes_desc">Más likes</option>
          <option value="likes_asc">Menos likes</option>
          <option value="title_asc">Título A–Z</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fFrom">Desde</label>
        <input id="fFrom" type="date" class="input"/>
      </div>
      <div class="form-group">
        <label for="fTo">Hasta</label>
        <input id="fTo" type="date" class="input"/>
      </div>
      <div class="form-group">
        <label for="fLimit">Por página</label>
        <select id="fLimit" class="input">
          <option>10</option>
          <option>20</option>
          <option>30</option>
          <option>50</option>
        </select>
      </div>
      <div class="form-group">
        <label>&nbsp;</label>
        <button id="btnClear" class="btn btn-outline"><i class="fa-solid fa-eraser"></i> Limpiar</button>
      </div>
    </div>

    <section id="reviewSection" class="card" style="margin-bottom:1.5rem; padding:1rem; display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem">
        <h2 style="margin:0;font-size:1.15rem">En revisión</h2>
        <span id="reviewCount" class="muted-sm"></span>
      </div>
      <div id="reviewEmpty" class="muted-sm" style="display:none">No hay diseños pendientes de revisión.</div>
      <div id="reviewList" class="review-list"></div>
    </section>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Título</th>
            <th>Diseñador</th>
            <th>Categoría</th>
            <th>Likes</th>
            <th>Publicado</th>
            <th class="right">Acciones</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <div class="pagination">
      <button id="prev" class="btn">←</button>
      <span id="pageInfo" class="muted-sm"></span>
      <button id="next" class="btn">→</button>
    </div>

    <!-- Modal: Editar -->
    <dialog id="modal">
      <form id="formEdit" method="dialog" class="card" style="padding:1rem;min-width:min(520px,95vw)">
        <h3>Editar diseño</h3>
        <input type="hidden" name="id"/>
        <label>Título
          <input class="input" name="title" required minlength="3"/>
        </label>
        <label>Descripción
          <textarea class="input" name="description" rows="4" placeholder="Opcional"></textarea>
        </label>
        <label>Categoría
          <select class="input" id="selCategory" name="category_id"></select>
        </label>
        <label style="display:flex;gap:.5rem;align-items:center">
          <input type="checkbox" name="published" class="switch"/> <span>Publicado</span>
        </label>
        <div id="msg" class="muted-sm" style="margin-top:.5rem"></div>
        <div style="display:flex;gap:.5rem;justify-content:flex-end;margin-top:1rem">
          <button type="button" id="btnClose" class="btn">Cancelar</button>
          <button class="btn-primary">Guardar</button>
        </div>
      </form>
    </dialog>
  </main>

  <footer class="site-footer">
    <div class="container footer-grid">
      <p>© 2025 Ludus Stamps. Todos los derechos reservados.</p>
      <p><a class="link" href="#contacto">Contacto</a></p>
    </div>
  </footer>

  <script src="/js/auth-ui.js" defer></script>
  <script src="/js/admin-designs.js" defer></script>
  <script>
  (function(){
    const here = location.pathname.replace(/\/+$/, "");
    document.querySelectorAll(".admin-subnav .tab").forEach(a => {
      const href = a.getAttribute("href").replace(/\/+$/, "");
      if (href === here) a.classList.add("active");
    });
  })();
</script>
</body>
</html>
